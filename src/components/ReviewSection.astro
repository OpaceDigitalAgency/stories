---
// Review Section Component
// This component displays reviews for stories, books, or authors

import RatingStars from './RatingStars.astro';

interface Props {
  itemType: 'story' | 'book' | 'author';
  itemId: string;
  itemName: string;
}

const { itemType, itemId, itemName } = Astro.props;

// Mock data for reviews
const reviews = [
  {
    id: 1,
    author: {
      name: "Parent of 7-year-old",
      avatar: "https://i.pravatar.cc/150?img=32",
      verified: true
    },
    rating: 5,
    title: "Sparked my child's imagination!",
    content: "This book has become my daughter's favorite bedtime story. The characters are relatable and the illustrations are beautiful. It's sparked so many conversations about the magic of reading and the importance of libraries. Highly recommended for children who love books and adventure!",
    helpfulCount: 24,
    date: new Date('2025-03-15'),
    ageGroup: "7-9 years"
  },
  {
    id: 2,
    author: {
      name: "Elementary School Teacher",
      avatar: "https://i.pravatar.cc/150?img=29",
      verified: true
    },
    rating: 4,
    title: "Great for classroom discussions",
    content: "I used this with my 3rd-grade class. The students were engaged and asked thoughtful questions. The only reason I'm giving 4 stars instead of 5 is that some of the vocabulary was challenging for a few students, but it provided good learning opportunities.",
    helpfulCount: 18,
    date: new Date('2025-03-20'),
    ageGroup: "8-10 years"
  }
];

// Filter options
const ageGroups = ["0-3 years", "4-6 years", "7-9 years", "10-12 years", "13+ years"];
const sortOptions = ["Most Helpful", "Highest Rated", "Newest", "Oldest"];
---

<div class="bg-white rounded-lg shadow-md overflow-hidden mt-8">
  <div class="p-6">
    <h2 class="text-2xl font-display font-bold text-text-primary mb-6">Reviews</h2>
    
    <!-- Reviews summary -->
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 pb-6 border-b border-gray-200">
      <div class="flex items-center mb-4 md:mb-0">
        <div class="text-4xl font-bold text-gray-800 mr-4">4.7</div>
        <div>
          <div class="flex text-yellow-400 mb-1">
            <RatingStars rating={4.7} />
          </div>
          <div class="text-sm text-gray-500">Based on {reviews.length} reviews</div>
        </div>
      </div>
      
      <div class="flex items-center">
        <a href={`/reviews?${itemType}=${itemId}`} class="btn btn-secondary py-2 px-4 rounded-md text-sm">
          View All Reviews
        </a>
        <a href={`/reviews/write?${itemType}=${itemId}`} class="btn btn-primary py-2 px-4 rounded-md text-sm ml-2">
          Write a Review
        </a>
      </div>
    </div>
    
    <!-- Reviews list -->
    <div class="space-y-6">
      {reviews.map(review => (
        <div class="border-b border-gray-100 pb-6 last:border-b-0">
          <div class="flex items-start">
            <div class="hidden sm:block w-10 h-10 rounded-full overflow-hidden mr-4 flex-shrink-0">
              <img 
                src={review.author.avatar} 
                alt={review.author.name} 
                class="w-full h-full object-cover"
              />
            </div>
            
            <div class="flex-1">
              <!-- Review Header -->
              <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-2">
                <div>
                  <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-700">{review.author.name}</span>
                    {review.author.verified && (
                      <span class="ml-1 bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded-full flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1">
                          <path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0112 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 013.498 1.307 4.491 4.491 0 011.307 3.497A4.49 4.49 0 0121.75 12a4.49 4.49 0 01-1.549 3.397 4.491 4.491 0 01-1.307 3.497 4.491 4.491 0 01-3.497 1.307A4.49 4.49 0 0112 21.75a4.49 4.49 0 01-3.397-1.549 4.49 4.49 0 01-3.498-1.306 4.491 4.491 0 01-1.307-3.498A4.49 4.49 0 012.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 011.307-3.497 4.49 4.49 0 013.497-1.307zm7.007 6.387a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                        </svg>
                        Verified
                      </span>
                    )}
                  </div>
                  <div class="flex items-center mt-1">
                    <div class="flex text-yellow-400">
                      <RatingStars rating={review.rating} />
                    </div>
                    <span class="text-xs text-gray-500 ml-2">{new Date(review.date).toLocaleDateString()}</span>
                  </div>
                </div>
                <span class="text-xs text-gray-500 mt-1 sm:mt-0">For ages: {review.ageGroup}</span>
              </div>
              
              <!-- Review Title & Content -->
              <h4 class="font-medium text-gray-800 mb-2">{review.title}</h4>
              <p class="text-gray-600 text-sm mb-3">{review.content}</p>
              
              <!-- Review Footer -->
              <div class="flex items-center text-sm">
                <button class="flex items-center text-gray-500 hover:text-gray-700">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.5c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 012.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 00.322-1.672V3a.75.75 0 01.75-.75A2.25 2.25 0 0116.5 4.5c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 01-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 00-1.423-.23H5.904M14.25 9h2.25M5.904 18.75c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 01-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 10.203 4.167 9.75 5 9.75h1.053c.472 0 .745.556.5.96a8.958 8.958 0 00-1.302 4.665c0 1.194.232 2.333.654 3.375z" />
                  </svg>
                  Helpful ({review.helpfulCount})
                </button>
                <button class="flex items-center text-gray-500 hover:text-gray-700 ml-4">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3v1.5M3 21v-6m0 0l2.77-.693a9 9 0 016.208.682l.108.054a9 9 0 006.086.71l3.114-.732a48.524 48.524 0 01-.005-10.499l-3.11.732a9 9 0 01-6.085-.711l-.108-.054a9 9 0 00-6.208-.682L3 4.5M3 15V4.5" />
                  </svg>
                  Report
                </button>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- View more link -->
    <div class="mt-6 text-center">
      <a href={`/reviews?${itemType}=${itemId}`} class="text-secondary hover:text-secondary/80 font-medium text-sm">
        View all {reviews.length} reviews â†’
      </a>
    </div>
  </div>
</div>